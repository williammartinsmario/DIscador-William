<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Discador William</title>
<link href="styles.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&amp;display=swap" rel="stylesheet"/></head>
<body>

<header style="display: flex; align-items: center; justify-content: space-between; padding: 10px 30px; background: white; border-bottom: 2px solid #eee;">
<div style="display: flex; align-items: center; gap: 12px;">
<img alt="WM Logo" src="logo.png" style="height: 50px;"/>
<h1 style="margin: 0; font-size: 24px; color: #003366; font-family: 'Poppins', sans-serif;">Wm Discador</h1>
</div>
<div style="font-family: 'Poppins', sans-serif; font-weight: bold; color: #cc3366;">
    ğŸ“ LigaÃ§Ãµes feitas: <span id="contador-ligacoes">0</span>
</div>
</header>
<div id="topo-botoes"><button onclick="limparFiltros()">Limpar Filtros</button><button onclick="exportarCSV()">ğŸ“¥ Backup</button><button onclick="resetGeral()">ğŸ”„ Reset Geral</button></div><div class="grupo-acoes"></div>
<!-- Aceita CSV, XLSX e XLS -->
<input accept=".csv,.xlsx,.xls" id="fileInput" type="file"/>
<div id="filtros">
<input id="filtroNome" placeholder="Filtrar por nome" type="text"/>
<select id="filtroLead">
<option value="">Todos os leads</option>
<option value="Quente">ğŸ”¥ Quente</option>
<option value="Frio">â„ï¸ Frio</option>
<option value="Aguardando">â³ Aguardando</option>
</select>
</div>
<div id="contador"></div>
<div id="lista-contatos"></div>
<h3>Contatos Feitos</h3>
<table id="contatos-feitos">
<thead>
<tr>
<th>Nome</th>
<th>NÃºmero</th>
<th>Status</th>
<th>InformaÃ§Ãµes</th>
<th>Lead</th>
<th>Data/Hora</th>
</tr>
</thead>
<tbody></tbody>
</table>
<script>

let contatos = [];
let contatosFeitos = JSON.parse(localStorage.getItem("contatosFeitos")) || [];
document.getElementById("fileInput").addEventListener("change", importarCSV);

function importarCSV(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    const lines = e.target.result.split('\n').slice(1);
    contatos = lines.map(l => {
      const [nome, numero] = l.split(',');
      return { nome: nome?.trim(), numero: numero?.trim() };
    }).filter(c => c.nome && c.numero);
    renderizarContatos();
    atualizarContador();
  };
  reader.readAsText(file);
}

function renderizarContatos() {
  const lista = document.getElementById("lista-contatos");
  lista.innerHTML = "";
  contatos.forEach((contato, index) => {
    if (document.getElementById("filtroNome").value &&
        !contato.nome.toLowerCase().includes(document.getElementById("filtroNome").value.toLowerCase())) return;

    const container = document.createElement("div");
    container.className = "contato-container";

    const linha = document.createElement("div");
    linha.className = "bloco";

    const nome = document.createElement("span");
    nome.innerText = contato.nome;

    const numero = document.createElement("span");
    numero.innerText = contato.numero;

    const botaoLigar = document.createElement("button");
    botaoLigar.innerText = "ğŸ“ Ligar";
    botaoLigar.onclick = () => {
      window.location.href = `tel:+55${contato.numero}`;
      form.style.display = "block";
    };

    const botaoZap = document.createElement("button");
    botaoZap.innerText = "ğŸ’¬ WhatsApp";
    botaoZap.onclick = () => {
      window.open(`https://wa.me/55${contato.numero}`, '_blank');
    };

    const botaoProximo = document.createElement("button");
    botaoProximo.innerText = "â–¶ï¸ PrÃ³ximo";
    botaoProximo.onclick = () => {
      const next = container.nextElementSibling;
      if (next) next.scrollIntoView({ behavior: "smooth" });
    };

    const form = document.createElement("div");
    form.className = "formulario";

    const status = document.createElement("select");
    ["Atendeu", "Caixa", "NÃ£o Atendeu", "Desligou", "Sem Resposta"].forEach(op => {
      const opt = document.createElement("option");
      opt.value = op;
      opt.innerText = op;
      status.appendChild(opt);
    });

    const info = document.createElement("textarea");
    info.placeholder = "InformaÃ§Ãµes adicionais";

    const lead = document.createElement("select");
    ["Quente", "Frio", "Aguardando"].forEach(l => {
      const opt = document.createElement("option");
      opt.value = l;
      opt.innerText = l;
      lead.appendChild(opt);
    });

    const salvar = document.createElement("button");
    salvar.innerText = "ğŸ’¾ Salvar";
    salvar.onclick = () => {
      if (!confirm("Deseja salvar este contato como feito?")) return;
      const dataHora = new Date().toLocaleString();
      contatosFeitos.push({
        nome: contato.nome,
        numero: contato.numero,
        status: status.value,
        info: info.value,
        lead: lead.value,
        dataHora
      });
      localStorage.setItem("contatosFeitos", JSON.stringify(contatosFeitos));
      atualizarContatosFeitos();
      contatos.splice(index, 1);
      renderizarContatos();
      atualizarContador();
    };

    form.appendChild(status);
    form.appendChild(document.createElement("br"));
    form.appendChild(info);
    form.appendChild(document.createElement("br"));
    form.appendChild(lead);
    form.appendChild(document.createElement("br"));
    form.appendChild(salvar);

    linha.appendChild(nome);
    linha.appendChild(numero);
    linha.appendChild(botaoLigar);
    linha.appendChild(botaoZap);
    linha.appendChild(botaoProximo);

    container.appendChild(linha);
    container.appendChild(form);
    lista.appendChild(container);
  });
}

function atualizarContatosFeitos() {
  const tbody = document.querySelector("#contatos-feitos tbody");
  tbody.innerHTML = "";
  contatosFeitos.forEach(c => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${c.nome}</td>
      <td>${c.numero}</td>
      <td>${c.status}</td>
      <td>${c.info}</td>
      <td>${c.lead}</td>
      <td>${c.dataHora}</td>
    `;
    tbody.appendChild(tr);
  });
}

function exportarCSV() {
  const csv = "Nome,NÃºmero,Status,InformaÃ§Ãµes,Lead,DataHora\n" + 
    contatosFeitos.map(c => [c.nome, c.numero, c.status, c.info, c.lead, c.dataHora].join(",")).join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "contatos_feitos.csv";
  a.click();
  URL.revokeObjectURL(url);
}

function atualizarContador() {
  const contador = document.getElementById("contador");
  const hoje = new Date().toLocaleDateString();
  const hojeFeitos = contatosFeitos.filter(c => c.dataHora.startsWith(hoje));
  contador.innerText = `ğŸ“Š LigaÃ§Ãµes feitas hoje: ${hojeFeitos.length}`;
}

function limparFiltros() {
  document.getElementById("filtroNome").value = "";
  document.getElementById("filtroLead").value = "";
  renderizarContatos();
}

document.getElementById("filtroNome").addEventListener("input", renderizarContatos);
document.getElementById("filtroLead").addEventListener("change", renderizarContatos);

atualizarContatosFeitos();
atualizarContador();

</script>
<script>
// HistÃ³rico individual no navegador
window.addEventListener("DOMContentLoaded", () => {
  const salvo = localStorage.getItem("contatosFeitos");
  if (salvo) {
    const tbody = document.querySelector("#contatos-feitos tbody");
    if (tbody) tbody.innerHTML = salvo;
  }

  const hist = document.querySelector("#contatos-feitos tbody");
  if (hist) {
    new MutationObserver(() => {
      localStorage.setItem("contatosFeitos", hist.innerHTML);
    }).observe(hist, { childList: true, subtree: true });
  }
});

// Reset Geral: limpa localStorage e recarrega
function resetGeral() {
  if (confirm("Tem certeza que deseja apagar tudo?")) {
    localStorage.removeItem("contatosFeitos");
    location.reload();
  }
}
</script>

<footer style="text-align: center; font-size: 14px; padding: 20px; background: #f4f4f4; margin-top: 30px; color: #444; font-family: 'Poppins', sans-serif;">
<img alt="WM Logo" src="logo.png" style="height: 40px; display: block; margin: 0 auto 10px;"/>
  WM Assessoria Â© Todos os direitos reservados
</footer>

</body>
</html>
